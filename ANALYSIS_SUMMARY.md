# Hydra ä»£ç åˆ†ææ‰§è¡Œæ‘˜è¦

## ğŸš¨ å…³é”®é—®é¢˜å¿«é€Ÿç´¢å¼•

### ä¸¥é‡é—®é¢˜ï¼ˆå¿…é¡»ç«‹å³ä¿®å¤ï¼‰ğŸ”´

1. **HTTP å®¢æˆ·ç«¯èµ„æºæ³„æ¼**
   - **ä½ç½®**: `plugins/llm/ollama_provider.py`, `plugins/llm/openai_provider.py`
   - **é—®é¢˜**: HTTP å®¢æˆ·ç«¯ä»æœªå…³é—­ï¼Œå¯¼è‡´è¿æ¥æ± æ³„æ¼
   - **å½±å“**: é•¿æœŸè¿è¡Œä¼šå¯¼è‡´èµ„æºè€—å°½
   - **ä¿®å¤**: å®ç°æ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä½¿ç”¨ `async with`

2. **è·¯å¾„éå†å®‰å…¨æ¼æ´**
   - **ä½ç½®**: `plugins/domain/domain_dispatcher.py:21-76`
   - **é—®é¢˜**: æ²¡æœ‰éªŒè¯è·¯å¾„å‚æ•°ï¼Œå¯èƒ½è¢«åˆ©ç”¨è¿›è¡Œè·¯å¾„éå†æ”»å‡»
   - **å½±å“**: å¯èƒ½å†™å…¥ç³»ç»Ÿæ–‡ä»¶ï¼Œå®‰å…¨é£é™©é«˜
   - **ä¿®å¤**: ä½¿ç”¨ `pathlib.Path.resolve()` éªŒè¯è·¯å¾„

3. **JSON è§£æè„†å¼±æ€§**
   - **ä½ç½®**: `modules/mimicry/content_strategy.py:72-80`
   - **é—®é¢˜**: ç®€å•çš„å­—ç¬¦ä¸²æŸ¥æ‰¾æ— æ³•å¤„ç†å¤æ‚ JSON
   - **å½±å“**: LLM è¿”å›çš„ JSON å¯èƒ½è§£æå¤±è´¥
   - **ä¿®å¤**: ä½¿ç”¨æ›´å¥å£®çš„ JSON æå–æ–¹æ³•

4. **ç¼ºå°‘æµ‹è¯•è¦†ç›–**
   - **ä½ç½®**: æ•´ä¸ªé¡¹ç›®
   - **é—®é¢˜**: æ²¡æœ‰ä»»ä½•æµ‹è¯•æ–‡ä»¶
   - **å½±å“**: æ— æ³•ä¿è¯ä»£ç è´¨é‡ï¼Œé‡æ„é£é™©é«˜
   - **ä¿®å¤**: æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### ä¸­ç­‰é—®é¢˜ï¼ˆå»ºè®®å°½å¿«ä¿®å¤ï¼‰ğŸŸ¡

1. **Logger å•ä¾‹çº¿ç¨‹ä¸å®‰å…¨**
   - **ä½ç½®**: `core/logger.py:19-28`
   - **é—®é¢˜**: å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½åˆ›å»ºå¤šä¸ªå®ä¾‹
   - **ä¿®å¤**: æ·»åŠ çº¿ç¨‹é”

2. **ç¼ºå°‘å¹¶å‘æ§åˆ¶**
   - **ä½ç½®**: `hydra.py:340-403`
   - **é—®é¢˜**: é¡µé¢ç”Ÿæˆæ˜¯é¡ºåºçš„ï¼Œæ²¡æœ‰åˆ©ç”¨å¼‚æ­¥å¹¶å‘
   - **ä¿®å¤**: ä½¿ç”¨ `asyncio.Semaphore` æ§åˆ¶å¹¶å‘æ•°

3. **ç¼ºå°‘é…ç½®éªŒè¯**
   - **ä½ç½®**: `core/config_loader.py`
   - **é—®é¢˜**: é…ç½®é”™è¯¯åœ¨è¿è¡Œæ—¶æ‰å‘ç°
   - **ä¿®å¤**: æ·»åŠ é…ç½®éªŒè¯å’Œç±»å‹æ£€æŸ¥

4. **LLMFactory ç¼“å­˜çº¿ç¨‹ä¸å®‰å…¨**
   - **ä½ç½®**: `plugins/llm/factory.py:16`
   - **é—®é¢˜**: å­—å…¸æ“ä½œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„
   - **ä¿®å¤**: æ·»åŠ çº¿ç¨‹é”

### ä½ä¼˜å…ˆçº§é—®é¢˜ï¼ˆå¯ä»¥åç»­ä¼˜åŒ–ï¼‰ğŸŸ¢

1. ç¡¬ç¼–ç å€¼è¿‡å¤š
2. ç¼ºå°‘æ—¥å¿—è½®è½¬
3. æœªä½¿ç”¨çš„ä»£ç ï¼ˆPipeline ç±»ï¼‰
4. ç¼ºå°‘æ€§èƒ½ç›‘æ§
5. ç¼ºå°‘ Docker æ”¯æŒ

---

## ğŸ“Š ä»£ç è´¨é‡è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | çŠ¶æ€ |
|------|------|------|
| æ¶æ„è®¾è®¡ | 8/10 | âœ… è‰¯å¥½ |
| ä»£ç è´¨é‡ | 6/10 | âš ï¸ éœ€æ”¹è¿› |
| æ€§èƒ½ | 5/10 | âš ï¸ éœ€æ”¹è¿› |
| å®‰å…¨æ€§ | 4/10 | ğŸ”´ éœ€ç«‹å³ä¿®å¤ |
| å¯ç»´æŠ¤æ€§ | 7/10 | âœ… è‰¯å¥½ |
| é”™è¯¯å¤„ç† | 6/10 | âš ï¸ éœ€æ”¹è¿› |
| æµ‹è¯•è¦†ç›– | 0/10 | ğŸ”´ ä¸¥é‡ç¼ºå¤± |

**æ€»ä½“è¯„åˆ†: 5.1/10** - éœ€è¦é‡å¤§æ”¹è¿›

---

## ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼ˆç´§æ€¥ - 1å‘¨å†…ï¼‰
1. âœ… ä¿®å¤ HTTP å®¢æˆ·ç«¯èµ„æºæ³„æ¼
2. âœ… ä¿®å¤è·¯å¾„éå†æ¼æ´
3. âœ… æ”¹è¿› JSON è§£æ
4. âœ… æ·»åŠ åŸºæœ¬æµ‹è¯•æ¡†æ¶

### ç¬¬äºŒé˜¶æ®µï¼ˆé‡è¦ - 1ä¸ªæœˆå†…ï¼‰
1. âœ… ä¿®å¤çº¿ç¨‹å®‰å…¨é—®é¢˜
2. âœ… æ·»åŠ å¹¶å‘æ§åˆ¶
3. âœ… æ·»åŠ é…ç½®éªŒè¯
4. âœ… æ”¹è¿›é”™è¯¯å¤„ç†

### ç¬¬ä¸‰é˜¶æ®µï¼ˆä¼˜åŒ– - 3ä¸ªæœˆå†…ï¼‰
1. âœ… æ·»åŠ æ€§èƒ½ç›‘æ§
2. âœ… å®Œå–„æµ‹è¯•è¦†ç›–
3. âœ… æ·»åŠ  Docker æ”¯æŒ
4. âœ… ä»£ç é‡æ„å’Œä¼˜åŒ–

---

## ğŸ” è¯¦ç»†åˆ†æ

å®Œæ•´åˆ†ææŠ¥å‘Šè¯·æŸ¥çœ‹: [DEEP_ANALYSIS.md](./DEEP_ANALYSIS.md)

---

## ğŸ“ å¿«é€Ÿä¿®å¤æŒ‡å—

### ä¿®å¤ HTTP å®¢æˆ·ç«¯æ³„æ¼

```python
# åœ¨ hydra.py ä¸­
async def __aenter__(self):
    if self.llm_provider:
        await self.llm_provider.__aenter__()
    return self

async def __aexit__(self, *args):
    if self.llm_provider:
        await self.llm_provider.__aexit__(*args)

# ä½¿ç”¨æ—¶
async with HydraEngine(config_path) as engine:
    await engine.generate_site()
```

### ä¿®å¤è·¯å¾„éå†æ¼æ´

```python
# åœ¨ domain_dispatcher.py ä¸­
from pathlib import Path

def resolve_path(self, project_config, hostname, path="/"):
    base = Path(base_path).resolve()
    safe_path = (base / hostname / path.lstrip("/")).resolve()
    
    # éªŒè¯è·¯å¾„åœ¨ base ç›®å½•å†…
    try:
        safe_path.relative_to(base)
    except ValueError:
        raise ValueError(f"Path {path} is outside base directory")
    
    return str(safe_path)
```

### æ”¹è¿› JSON è§£æ

```python
import json
import re

def extract_json(text: str) -> Optional[Dict]:
    # å°è¯•å¤šç§æ–¹æ³•æå– JSON
    patterns = [
        r'\{[^{}]*(?:\{[^{}]*\}[^{}]*)*\}',  # ç®€å•åµŒå¥—
        r'\{.*?\}',  # éè´ªå©ªåŒ¹é…
    ]
    
    for pattern in patterns:
        matches = re.findall(pattern, text, re.DOTALL)
        for match in matches:
            try:
                return json.loads(match)
            except json.JSONDecodeError:
                continue
    
    return None
```

---

**ç”Ÿæˆæ—¶é—´**: 2024-01-01  
**åˆ†æç‰ˆæœ¬**: 1.0.0

