{% extends "layout.html" %}

{% block title %}Dashboard - Hydra Command Center{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold text-cyber-green cyber-glow mb-8">Dashboard</h1>
    
    <!-- Status Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <!-- Engine Status -->
        <div class="bg-dark-panel cyber-border rounded-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-300">Engine Status</h3>
                <span class="w-3 h-3 rounded-full {% if status.engine_ready %}bg-cyber-green{% else %}bg-red-500{% endif %}"></span>
            </div>
            <p class="text-sm text-gray-400">
                {% if status.engine_ready %}
                    âœ“ Ready
                {% else %}
                    âœ— Not Ready
                {% endif %}
            </p>
        </div>
        
        <!-- LLM Health -->
        <div class="bg-dark-panel cyber-border rounded-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-300">LLM Provider</h3>
                <span class="w-3 h-3 rounded-full {% if status.llm_health %}bg-cyber-green{% else %}bg-yellow-500{% endif %}"></span>
            </div>
            <p class="text-sm text-gray-400">
                {% if status.llm_health %}
                    âœ“ Healthy
                {% else %}
                    âš  Check Connection
                {% endif %}
            </p>
        </div>
        
        <!-- Generation Status -->
        <div class="bg-dark-panel cyber-border rounded-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-300">Generation</h3>
                <span class="w-3 h-3 rounded-full {% if status.generation_running %}bg-yellow-500 animate-pulse{% elif status.generation_error %}bg-red-500{% else %}bg-gray-500{% endif %}"></span>
            </div>
            <p class="text-sm text-gray-400">
                {% if status.generation_running %}
                    â³ Running...
                {% elif status.generation_error %}
                    âœ— Error
                {% else %}
                    âœ“ Idle
                {% endif %}
            </p>
        </div>
    </div>
    
    <!-- Action Center -->
    <div class="bg-dark-panel cyber-border rounded-lg p-6 mb-8">
        <h2 class="text-xl font-semibold text-cyber-green mb-4">Action Center</h2>
        
        <div class="flex items-center gap-4">
            <button
                id="generate-btn"
                hx-post="/action/generate"
                hx-target="#generate-result"
                hx-swap="innerHTML"
                class="px-6 py-3 bg-cyber-green text-black font-semibold rounded hover:bg-cyber-green/80 transition disabled:opacity-50 disabled:cursor-not-allowed"
                {% if status.generation_running %}disabled{% endif %}
            >
                {% if status.generation_running %}
                    <span class="inline-block animate-spin mr-2">â³</span>
                    Generating...
                {% else %}
                    ğŸš€ Generate Site
                {% endif %}
            </button>
            
            <button
                hx-get="/status"
                hx-target="#status-info"
                hx-swap="innerHTML"
                hx-trigger="every 2s"
                class="px-4 py-2 bg-gray-700 text-gray-200 rounded hover:bg-gray-600 transition"
            >
                ğŸ”„ Refresh Status
            </button>
        </div>
        
        <div id="generate-result" class="mt-4"></div>
    </div>
    
    <!-- Last Run Info -->
    {% if status.last_run %}
    <div class="bg-dark-panel cyber-border rounded-lg p-6">
        <h2 class="text-xl font-semibold text-cyber-green mb-4">Last Run</h2>
        <p class="text-gray-400">
            <span class="text-cyber-green">â°</span>
            {{ status.last_run }}
        </p>
        {% if status.generation_error %}
        <div class="mt-4 p-4 bg-red-900/30 border border-red-500 rounded">
            <p class="text-red-400 text-sm">{{ status.generation_error }}</p>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Status Info (Auto-refresh) -->
    <div id="status-info" class="hidden"></div>
</div>

<script>
    // Auto-refresh status every 5 seconds
    setInterval(() => {
        fetch('/status')
            .then(r => r.json())
            .then(data => {
                // Update UI based on status
                const generateBtn = document.getElementById('generate-btn');
                if (data.generation_running) {
                    generateBtn.disabled = true;
                    generateBtn.innerHTML = '<span class="inline-block animate-spin mr-2">â³</span> Generating...';
                } else {
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = 'ğŸš€ Generate Site';
                }
            });
    }, 5000);
</script>
{% endblock %}

